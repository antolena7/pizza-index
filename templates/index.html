<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pizza Index Tracker ‚Äì Live Pentagon Pizza Activity</title>
    <meta name="description" content="Follow live Pentagon pizza orders with the Pizza Index Tracker. Real-time OSINT data and suspicious delivery spikes.">
    <meta name="google-site-verification" content="UGYZ7IQOeo1HPOEsYdf4gJbW9D-NpOL2fvuzO7pj13c" />
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='favicon.png') }}" />
    
    <!-- Open Graph / Facebook -->
    <meta property="og:title" content="The Pizza Index ‚Äì Live Pentagon Pizza Tracker" />
    <meta property="og:description" content="Follow real-time pizza activity near the Pentagon. Updated live." />
    <meta property="og:image" content="{{ request.url_root }}static/pizza-social-preview.png" />
    <meta property="og:url" content="{{ request.url }}" />

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Amatic+SC:wght@700&display=swap" rel="stylesheet" />

    <!-- Leaflet Map CSS & JS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0; padding: 0;
            background: url('https://www.transparenttextures.com/patterns/paper-fibers.png');
            background-color: #fff9f0;
            color: #333;
            border-left: 15px solid #d8411f;
            border-right: 15px solid #d8411f;
        }

        header {
            background: #d8411f;
            color: white;
            padding: 1rem;
            text-align: center;
        }

        header h1 {
            font-family: 'Amatic SC', cursive;
            font-size: 3rem;
            letter-spacing: 1px;
            margin: 0;
        }

        main {
            max-width: 1000px;
            margin: auto;
            padding: 1rem;
            display: flex;
            gap: 2rem;
            flex-wrap: wrap;
        }

        #content {
            flex: 1 1 600px;
            min-width: 300px;
        }

        #report-form {
            flex: 0 0 320px;
            background: #fff1e0;
            border: 2px solid #d8411f;
            border-radius: 8px;
            padding: 1rem;
            box-shadow: 2px 2px 8px rgba(216, 65, 31, 0.2);
            font-size: 0.9rem;
        }

        h2 {
            font-family: 'Amatic SC', cursive;
            font-size: 2rem;
            margin-top: 0;
            color: #d8411f;
        }

        section {
            margin-bottom: 2rem;
        }

        .alert-box {
            background: #ffe0cc;
            padding: 1rem;
            border-left: 6px solid #d8411f;
            font-weight: bold;
            margin: 1rem 0;
        }

        #map {
            height: 400px;
            width: 100%;
            border-radius: 8px;
            border: 2px dashed #d8411f;
        }

        footer {
            text-align: center;
            font-size: 12px;
            padding: 1.5rem;
            color: #777;
        }

        a {
            color: #d8411f;
            text-decoration: none;
        }

        .news-card {
            border: 2px dashed #d8411f;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1.5rem;
            background: #fff4ee;
        }

        .news-card h3 {
            margin-top: 0;
            color: #d8411f;
        }

        .anomaly-card {
            border: 1px solid #d8411f;
            border-radius: 6px;
            padding: 1rem;
            margin-bottom: 1rem;
            background: #fff9f0;
        }

        .anomaly-card small {
            color: #666;
        }

        #floating-share {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #d8411f;
            color: white;
            padding: 0.7rem 1rem;
            border-radius: 50px;
            font-weight: bold;
            text-decoration: none;
            font-family: Arial, sans-serif;
            box-shadow: 2px 2px 6px rgba(0,0,0,0.2);
            z-index: 1000;
            transition: background 0.3s;
        }

        #floating-share:hover {
            background: #b53318;
        }

        form label {
            font-weight: bold;
        }
        
        form input[type="email"],
        form textarea {
            width: 100%;
            box-sizing: border-box;
            padding: 0.5rem;
            border: 1px solid #d8411f;
            border-radius: 4px;
            font-family: inherit;
            font-size: 1rem;
            margin-top: 0.25rem;
        }
        
        form textarea {
            resize: vertical;
        }

        form button {
            background-color: #d8411f;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            font-weight: bold;
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.3s ease;
        }
        
        form button:hover {
            background-color: #b53318;
        }

        @media (max-width: 768px) {
            body {
                border-left: none;
                border-right: none;
                padding: 0 0.5rem;
            }

            header h1 {
                font-size: 2.2rem;
            }

            main {
                flex-direction: column;
                padding: 0.5rem;
            }

            #content {
                width: 100%;
            }

            #report-form {
                width: 100%;
                flex: none;
                margin-top: 2rem;
                padding: 1rem;
            }

            #map {
                height: 350px;
                border: none;
                border-radius: 0;
                width: 100vw;
                margin-left: -0.5rem;
            }

            .alert-box {
                font-size: 0.95rem;
                line-height: 1.4;
            }

            .news-card {
                font-size: 0.95rem;
            }
        }

        @media (max-width: 480px) {
            header h1 {
                font-size: 2rem;
            }

            h2 {
                font-size: 1.7rem;
            }

            .leaflet-popup-content {
                font-size: 0.9rem;
            }

            footer {
                font-size: 10px;
                padding: 1rem;
            }
        }
    </style>

    <script>
        function copyLink() {
            navigator.clipboard.writeText("{{ request.url }}").then(function() {
                document.getElementById("copy-confirmation").style.display = "block";
                setTimeout(() => {
                    document.getElementById("copy-confirmation").style.display = "none";
                }, 2000);
            });
        }
    </script>
</head>
<body>
    <!-- Floating Share Button -->
    <a href="https://api.whatsapp.com/send?text=Check%20out%20The%20Pizza%20Index!%20üçï%20{{ request.url }}" target="_blank" id="floating-share">
        üçï Share
    </a>

    <header>
        <h1>Pizza Index</h1>
        <p>Tracking Pentagon Activity One Slice at a Time üçïüîç</p>
    </header>

    <main>
        <div id="content">
            <!-- Historical Correlations -->
            <section>
                <h2>üß† Historical Correlations</h2>
                <p>We log and analyze pizza activity spikes that correlate with major military events near the Pentagon.</p>
                <ul>
                    {% if featured_correlations %}
                        {% for correlation in featured_correlations %}
                        <li><strong>{{ correlation.date.strftime('%B %d, %Y') }}:</strong> {{ correlation.description }}</li>
                        {% endfor %}
                    {% else %}
                    <li><strong>June 12, 2025:</strong> Escalation involving Israel/Iran mirrored by a +42% spike in pizza volume.</li>
                    <li><strong>June 21‚Äì22, 2025:</strong> Just before U.S. airstrikes on Iranian nuclear facilities, area-wide pizza demand rose significantly (+65%).</li>
                    {% endif %}
                </ul>
            </section>

            <!-- Interactive Map -->
            <section>
                <h2>üìç Pizza Surveillance Map</h2>
                <p>Click on any outlet to see delivery spikes, historical data, and proximity to the Pentagon.</p>
                <div id="map"></div>
            </section>

            <!-- Pizza Watch -->
            <section>
                <h2>üö® Pizza Watch</h2>
                <div class="alert-box">
                    üçï <strong>{{ (recent_activities[0][0].timestamp if recent_activities else datetime.now()).strftime('%B %d, %Y') }} ‚Äì Peak Hours</strong> ‚Äì Real-time Google Maps data:
                    <ul>
                        {% if recent_activities %}
                            {% for activity, outlet in recent_activities %}
                            <li><strong>{{ outlet.name }} ‚Äì {{ outlet.address }}</strong>: {{ activity.busy_level }} at {{ activity.timestamp.strftime('%I:%M %p') }}</li>
                            {% endfor %}
                        {% else %}
                        <li><strong>Extreme Pizza ‚Äì 1419 S Fern St</strong>: a bit busier than usual at 4:00 PM</li>
                        <li><strong>We, The Pizza ‚Äì 2100 Crystal Dr</strong>: less busy than usual at 4:00 PM</li>
                        <li><strong>District Pizza Palace ‚Äì 2325 S Eads St</strong>: less busy than usual at 4:00 PM</li>
                        <li><strong>California Pizza Kitchen at Pentagon ‚Äì 1201 S Hayes St</strong>: not busy at 4:00 PM</li>
                        <li><strong>Domino's Pizza ‚Äì 3535 S Ball St</strong>: less busy than usual at 4:00 PM</li>
                        <li><strong>Domino's Pizza ‚Äì 2029 K St NW</strong>: less busy than usual at 1:00 PM (July 14)</li>
                        {% endif %}
                    </ul>
                </div>
                <p>Source: Google Maps "Popular Times"</p>
            </section>

            <!-- Live Geo Events -->
            <section id="geo-news">
                <h2>üì∞ Live Geo Events</h2>
                <div id="news-cards">
                    {% if latest_events %}
                        {% for event in latest_events %}
                        <div class="news-card">
                            <h3>{{ event.source }}: {{ event.title }}</h3>
                            <p><em>{{ event.published_date.strftime('%m/%d/%Y') if event.published_date else '8/30/2025' }}</em></p>
                            <p><strong>Why it matters:</strong> {{ event.description }}</p>
                            <a href="{{ event.url }}" target="_blank">Read more</a>
                        </div>
                        {% endfor %}
                    {% else %}
                    <div class="news-card">
                        <h3>NY Times: Russia Distracts Its Citizens From Ukraine War With Nonstop Festivals</h3>
                        <p><em>8/30/2025</em></p>
                        <p><strong>Why it matters:</strong> This event is significant for global geopolitical stability and may influence regional policies.</p>
                        <a href="https://www.nytimes.com/2025/08/30/world/europe/russia-ukraine-war-summer-in-moscow.html" target="_blank">Read more</a>
                    </div>
                    <div class="news-card">
                        <h3>NY Times: Over 15 Killed in Gaza City, One Day After Israel Ends Daily Pauses for Aid</h3>
                        <p><em>8/30/2025</em></p>
                        <p><strong>Why it matters:</strong> Key developments here could affect international relations and military strategies.</p>
                        <a href="https://www.nytimes.com/2025/08/30/world/middleeast/gaza-israel-deadly-strikes.html" target="_blank">Read more</a>
                    </div>
                    <div class="news-card">
                        <h3>BBC: Houthis confirm their prime minister killed in Israeli strike</h3>
                        <p><em>8/30/2025</em></p>
                        <p><strong>Why it matters:</strong> This event is significant for global geopolitical stability and may influence regional policies.</p>
                        <a href="https://www.bbc.com/news/articles/c620ykrxedwo?at_medium=RSS&at_campaign=rss" target="_blank">Read more</a>
                    </div>
                    <div class="news-card">
                        <h3>BBC: Prominent Ukrainian politician Andriy Parubiy shot dead in Lviv</h3>
                        <p><em>8/30/2025</em></p>
                        <p><strong>Why it matters:</strong> Key developments here could affect international relations and military strategies.</p>
                        <a href="https://www.bbc.com/news/articles/cjw6ep37469o?at_medium=RSS&at_campaign=rss" target="_blank">Read more</a>
                    </div>
                    {% endif %}
                </div>
            </section>

            <!-- Global Pizza Index Placeholder -->
            <section>
                <h2>üìà Global Pizza Index</h2>
                <div style="background: #fff4ee; padding: 1rem; border: 1px dashed #d8411f; border-radius: 8px;">
                    <p style="margin: 0;">Global correlation analysis coming soon...</p>
                </div>
            </section>

            <!-- About Section -->
            <section>
                <h2>üë§ About This Project</h2>
                <h4 style="color: #d8411f; margin-bottom: 1rem;">What is the Pizza Index?</h4>
                <p>An independent OSINT initiative tracking behavioral patterns via food delivery data. All sources are public. No personal data collected ‚Äî only pizza slices.</p>
                <blockquote style="font-style: italic; text-align: center; padding: 1rem; background: rgba(216, 65, 31, 0.1); border-left: 4px solid #d8411f; margin: 1rem 0;">
                    "Correlation isn't causation ‚Äî but correlation with mozzarella deserves a second glance."
                </blockquote>
            </section>
        </div>

        <!-- Sidebar with Reported Anomalies and Report Form -->
        <aside>
            <!-- Reported Anomalies -->
            <div id="user-anomalies" style="margin-bottom: 2rem;">
                <h2>üì° Reported Anomalies</h2>
                <p>Here's what fellow pizza watchers have spotted:</p>

                <div class="anomaly-card">
                    <p><strong>üü† Anomaly:</strong> Folks on Bluesky are claiming that there's been a dramatic surge in orders at <em>Pizzato's Pizza</em>.</p>
                    <small>Submitted: 30/08/2025</small>
                </div>
                <div class="anomaly-card">
                    <p><strong>üü† Anomaly:</strong> Increased delivery traffic observed near <em>Extreme Pizza</em> around 5 PM.</p>
                    <small>Submitted: 30/08/2025</small>
                </div>
            </div>

            <!-- Report Form -->
            <div id="report-form">
                <h2>üïµÔ∏è Report Suspicious Pizza Activity</h2>
                <form>
                    <p><label for="email">Your Email:</label><br>
                    <input type="email" id="email" name="email" placeholder="your@email.com" required></p>

                    <p><label for="report">Anomaly Details:</label><br>
                    <textarea id="report" name="report" rows="4" placeholder="Describe what you observed (outlet name, time, unusual activity, etc.)" required></textarea></p>

                    <button type="submit">Submit Report</button>
                </form>
                
                <div id="copy-confirmation" style="display: none; background: #d4edda; border: 1px solid #c3e6cb; color: #155724; padding: 0.5rem; border-radius: 4px; margin-top: 1rem;">
                    ‚úÖ Link copied!
                </div>
                
                <p style="margin-top: 1rem; font-size: 0.85rem; color: #666;">
                    <strong>üçï Share This Slice</strong><br>
                    If you found this tasty, share it. One slice could expose a thousand secrets.
                </p>
                
                <div style="margin-top: 0.5rem;">
                    <button onclick="copyLink()" style="background: transparent; border: 1px solid #d8411f; color: #d8411f; padding: 0.3rem 0.6rem; border-radius: 4px; font-size: 0.8rem; cursor: pointer; margin-right: 0.5rem;">üìé Copy Link</button>
                    <a href="https://twitter.com/intent/tweet?text=Pizza%20spikes%20near%20the%20Pentagon%3F%20You%20need%20to%20see%20this.%20üçï%20{{ request.url }}" target="_blank" style="font-size: 0.8rem; margin-right: 0.5rem;">üê¶ Tweet</a>
                    <a href="https://t.me/share/url?url={{ request.url }}&text=This%20OSINT%20pizza%20site%20is%20wild%20üçï" target="_blank" style="font-size: 0.8rem; margin-right: 0.5rem;">‚úàÔ∏è Telegram</a>
                    <a href="mailto:?subject=Check%20this%20out!&body=Pentagon%20pizza%20spikes%20explained%20üçï%20{{ request.url }}" style="font-size: 0.8rem; margin-right: 0.5rem;">‚úâÔ∏è Email</a>
                    <a href="https://www.reddit.com/submit?url={{ request.url }}&title=Pentagon%20Pizza%20Spikes%20are%20Real.%20OSINT%20says%20so.%20üçï" target="_blank" style="font-size: 0.8rem;">üëΩ Reddit</a>
                </div>
            </div>
        </aside>
    </main>

    <footer>
        <p>Independent OSINT initiative ‚Ä¢ All data from public sources ‚Ä¢ No personal data collected</p>
    </footer>

    <!-- Include enhanced map script -->
    <script src="{{ url_for('static', filename='js/map.js') }}"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>

    <script>
        // Auto-refresh news feed 
        const FEEDS = [
            { url: 'https://api.rss2json.com/v1/api.json?rss_url=https://feeds.reuters.com/Reuters/worldNews', source: 'Reuters' },
            { url: 'https://api.rss2json.com/v1/api.json?rss_url=https://rss.nytimes.com/services/xml/rss/nyt/World.xml', source: 'NY Times' },
            { url: 'https://api.rss2json.com/v1/api.json?rss_url=http://feeds.bbci.co.uk/news/world/rss.xml', source: 'BBC' }
        ];

        const neutralReasons = [
            "This event is significant for global geopolitical stability and may influence regional policies.",
            "Key developments here could affect international relations and military strategies.",
            "Important news that might have repercussions on diplomatic efforts and security measures.",
            "This situation deserves attention due to its potential impact on global peace and conflict dynamics.",
            "Ongoing events like this can reshape alliances and affect strategic decisions worldwide."
        ];

        async function loadNews() {
            const container = document.getElementById('news-cards');
            if (!container) return;

            // First try to get news from Flask API
            try {
                const response = await fetch('/api/news-feed');
                const newsData = await response.json();
                
                if (newsData && newsData.length > 0) {
                    container.innerHTML = '';
                    newsData.forEach(article => {
                        const card = document.createElement('div');
                        card.className = 'news-card';
                        card.innerHTML = `
                            <h3>${article.source}: ${article.title}</h3>
                            <p><em>${article.published_date}</em></p>
                            <p><strong>Why it matters:</strong> ${article.description}</p>
                            <a href="${article.url}" target="_blank">Read more</a>
                        `;
                        container.appendChild(card);
                    });
                    return;
                }
            } catch (e) {
                console.log('Flask API not available, using RSS feeds');
            }

            // Fallback to RSS feeds
            for (const feed of FEEDS) {
                try {
                    const res = await fetch(feed.url);
                    const data = await res.json();

                    data.items.slice(0, 2).forEach((item, idx) => {
                        const card = document.createElement('div');
                        card.className = 'news-card';

                        const title = item.title.length > 80
                            ? item.title.slice(0, 77) + '‚Ä¶'
                            : item.title;

                        const whyItMatters = neutralReasons[idx % neutralReasons.length];

                        card.innerHTML = `
                            <h3>${feed.source}: ${title}</h3>
                            <p><em>${new Date(item.pubDate).toLocaleDateString()}</em></p>
                            <p><strong>Why it matters:</strong> ${whyItMatters}</p>
                            <a href="${item.link}" target="_blank">Read more</a>
                        `;

                        container.appendChild(card);
                    });
                } catch (e) {
                    console.error('Error loading', feed.source, e);
                }
            }
        }

        // Load news when page loads and refresh every 8 minutes
        document.addEventListener('DOMContentLoaded', function() {
            loadNews();
            setInterval(loadNews, 8 * 60 * 1000);
        });
    </script>
</body>
</html>